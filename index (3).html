<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Vokabeltrainer</title>
    <style>
        /* Bestehende CSS-Stile */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        .container {
            max-width: 800px;
            margin: auto;
        }
        .list-header, .coin-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .list-header h2, .coin-section h2 {
            margin: 0;
        }
        /* Alle Buttons mit dem Blauton stylen */
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        #lists, #vocabularies {
            list-style-type: none;
            padding: 0;
            margin-top: 20px;
        }
        #lists li, #vocabularies li {
            background-color: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #lists li:hover, #vocabularies li:hover {
            background-color: #e9ecef;
        }
        #vocabularies li {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .icon {
            cursor: pointer;
            font-size: 24px;
            color: #dc3545;
            transition: color 0.3s;
        }
        .icon:hover {
            color: #c82333;
        }
        .hidden {
            display: none;
        }
        input[type="text"], input[type="number"] {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
            font-size: 16px;
        }
        /* Modale Fenster */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 95%;
            max-width: 500px;
            border-radius: 10px;
            animation: modalFadeIn 0.5s;
            position: relative;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-header {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        .modal-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .modal-buttons {
            text-align: right;
        }
        .modal-buttons button {
            margin-left: 10px;
        }
        /* Spezifische Styles für das Quiz-Modale */
        #quizModal .modal-content {
            margin-top: 5%;
        }
        #quizResult {
            margin-top: 10px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }
        /* Neues Design für das Quiz */
        .progress-bar {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .progress-fill {
            height: 10px;
            background-color: #007bff;
            width: 0%;
            transition: width 0.3s;
        }
        .quiz-question {
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        .quiz-input {
            font-size: 18px;
            padding: 10px;
            margin-bottom: 10px;
        }
        /* Neues Styling für die Quiz-Einstellungen */
        .quiz-option {
            display: inline-block;
            width: 45%;
            margin: 5px 2.5%;
            padding: 15px;
            background-color: #e9ecef;
            color: #333;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        .quiz-option:hover {
            background-color: #ced4da;
        }
        .quiz-option.selected {
            background-color: #007bff;
            color: white;
        }
        /* Statistiken-Modal */
        #quizEndModal .modal-content {
            margin-top: 10%;
            text-align: center;
        }
        .stats {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .stats .number {
            font-weight: bold;
            font-size: 24px;
            color: #007bff;
        }
        /* Pie Chart Canvas */
        #quizChart {
            margin: 20px auto;
            display: block;
        }
        /* Snake Game Styles */
        #snakeGameCanvas {
            display: block;
            margin: 0 auto;
            background-color: #000;
            border: 1px solid #ccc;
        }
        #snakeGameModal .modal-content {
            width: 95%;
            max-width: 600px;
            padding: 0;
            overflow: hidden;
        }
        #snakeGameScore {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            font-size: 18px;
        }
        #snakeGameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 24px;
            text-align: center;
        }
        #closeSnakeGameBtn {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        /* Game Selection Modal */
        .game-option {
            display: block;
            width: 90%;
            margin: 10px auto;
            padding: 15px;
            background-color: #e9ecef;
            color: #333;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        .game-option:hover {
            background-color: #ced4da;
        }
    </style>
    <!-- Einbindung von Chart.js über CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">
    <h1>Vokabeltrainer</h1>

    <!-- Münzenanzeige -->
    <div class="coin-section">
        <h2>Münzen: <span id="coinCount">0</span> &#128176;</h2>
        <button id="playGameBtn">Spiel spielen (1 Münze)</button>
    </div>
<br>
    <div class="list-header">
        <h2>Vokabellisten</h2>
        <button id="addListBtn">+ Neue Liste</button>
    </div>

    <ul id="lists">
        <!-- Vokabellisten werden hier angezeigt -->
    </ul>

    <div id="vocabSection" class="hidden">
        <div class="list-header">
            <h2 id="listName">Liste: </h2>
            <button id="addVocabBtn">+ Neue Vokabel</button>
        </div>

        <ul id="vocabularies">
            <!-- Vokabeln werden hier angezeigt -->
        </ul>

        <button id="startQuizBtn">Quiz starten</button>
    </div>
</div>

<!-- Modale Fenster -->
<div id="listModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Neue Liste erstellen</div>
        <input type="text" id="listNameInput" class="modal-input" placeholder="Name der neuen Liste">
        <div class="modal-buttons">
            <button id="cancelListBtn">Abbrechen</button>
            <button id="saveListBtn">Speichern</button>
        </div>
    </div>
</div>

<div id="vocabModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Neue Vokabel hinzufügen</div>
        <input type="text" id="wordInput" class="modal-input" placeholder="Fremdwort (z.B. Englisch)">
        <input type="text" id="translationInput" class="modal-input" placeholder="Übersetzung (z.B. Deutsch)">
        <div class="modal-buttons">
            <button id="cancelVocabBtn">Abbrechen</button>
            <button id="saveVocabBtn">Speichern</button>
        </div>
    </div>
</div>

<div id="quizSettingsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Quiz-Einstellungen</div>
        <div class="quiz-options">
            <div class="quiz-option selected" data-value="toGerman">Fremdsprache ➔ Deutsch</div>
            <div class="quiz-option" data-value="fromGerman">Deutsch ➔ Fremdsprache</div>
        </div>
        <div class="modal-buttons">
            <button id="cancelQuizSettingsBtn">Abbrechen</button>
            <button id="startQuizNowBtn">Quiz starten</button>
        </div>
    </div>
</div>

<div id="quizModal" class="modal">
    <div class="modal-content">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="quiz-question">
            Übersetze: <strong id="quizWord"></strong>
        </div>
        <input type="text" id="quizInput" class="modal-input" placeholder="Antwort eingeben...">
        <div id="quizResult"></div>
        <div class="modal-buttons">
            <button id="submitQuizAnswerBtn">Antwort abschicken</button>
        </div>
    </div>
</div>

<div id="quizEndModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Quiz beendet!</div>
        <div class="stats">
            Gesamtzahl der Fragen: <span class="number" id="totalQuestions"></span>
        </div>
        <div class="stats">
            Richtige Antworten: <span class="number" id="correctAnswers"></span>
        </div>
        <div class="stats">
            Falsche Antworten: <span class="number" id="wrongAnswers"></span>
        </div>
        <!-- Canvas für das Kreisdiagramm -->
        <canvas id="quizChart" width="200" height="200"></canvas>
        <div class="modal-buttons">
            <button id="closeQuizEndBtn">Schließen</button>
        </div>
    </div>
</div>

<!-- Game Selection Modal -->
<div id="gameSelectionModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Wähle ein Spiel</div>
        <div class="game-option" data-game="snake">Snake</div>
        <div class="game-option" data-game="numberGuess">Zahlenratespiel</div>
        <div class="modal-buttons">
            <button id="cancelGameSelectionBtn">Abbrechen</button>
        </div>
    </div>
</div>

<!-- Snake Game Modal -->
<div id="snakeGameModal" class="modal">
    <div class="modal-content">
        <canvas id="snakeGameCanvas" width="400" height="400"></canvas>
        <div id="snakeGameScore">Punkte: 0</div>
        <div id="snakeGameOver" class="hidden">Game Over<br>Punkte: <span id="finalScore">0</span></div>
        <button id="closeSnakeGameBtn">Schließen</button>
    </div>
</div>

<!-- Number Guessing Game Modal -->
<div id="numberGuessGameModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Zahlenratespiel</div>
        <div class="game-instructions">
            Errate die Zahl zwischen 1 und 10!
        </div>
        <input type="number" id="numberGuessInput" class="modal-input" placeholder="Dein Tipp...">
        <div id="numberGuessResult"></div>
        <div class="modal-buttons">
            <button id="submitNumberGuessBtn">Raten</button>
            <button id="closeNumberGuessGameBtn">Schließen</button>
        </div>
    </div>
</div>

<script>
    // Variablen
    let lists = JSON.parse(localStorage.getItem('vocabLists')) || [];
    let coins = parseInt(localStorage.getItem('coins')) || 0;
    let totalCorrectAnswers = parseInt(localStorage.getItem('totalCorrectAnswers')) || 0;
    let currentListIndex = null;
    let currentQuiz = null;
    let quizQueue = [];
    let correctAnswers = 0;
    let wrongAnswers = 0;
    let quizDirection = 'toGerman'; // 'toGerman' oder 'fromGerman'
    let maxAttempts = 2; // Maximale Anzahl der Versuche pro Vokabel

    const listsElement = document.getElementById('lists');
    const vocabSection = document.getElementById('vocabSection');
    const vocabulariesElement = document.getElementById('vocabularies');
    const listNameElement = document.getElementById('listName');
    const addListBtn = document.getElementById('addListBtn');
    const addVocabBtn = document.getElementById('addVocabBtn');
    const startQuizBtn = document.getElementById('startQuizBtn');
    const coinCountElement = document.getElementById('coinCount');
    const playGameBtn = document.getElementById('playGameBtn');

    // Modale Elemente
    const listModal = document.getElementById('listModal');
    const listNameInput = document.getElementById('listNameInput');
    const saveListBtn = document.getElementById('saveListBtn');
    const cancelListBtn = document.getElementById('cancelListBtn');

    const vocabModal = document.getElementById('vocabModal');
    const wordInput = document.getElementById('wordInput');
    const translationInput = document.getElementById('translationInput');
    const saveVocabBtn = document.getElementById('saveVocabBtn');
    const cancelVocabBtn = document.getElementById('cancelVocabBtn');

    const quizSettingsModal = document.getElementById('quizSettingsModal');
    const cancelQuizSettingsBtn = document.getElementById('cancelQuizSettingsBtn');
    const startQuizNowBtn = document.getElementById('startQuizNowBtn');
    const quizOptionElements = document.querySelectorAll('.quiz-option');

    const quizModal = document.getElementById('quizModal');
    const quizWordElement = document.getElementById('quizWord');
    const quizInput = document.getElementById('quizInput');
    const submitQuizAnswerBtn = document.getElementById('submitQuizAnswerBtn');
    const quizResultElement = document.getElementById('quizResult');
    const progressFill = document.getElementById('progressFill');

    const quizEndModal = document.getElementById('quizEndModal');
    const totalQuestionsElement = document.getElementById('totalQuestions');
    const correctAnswersElement = document.getElementById('correctAnswers');
    const wrongAnswersElement = document.getElementById('wrongAnswers');
    const closeQuizEndBtn = document.getElementById('closeQuizEndBtn');

    const gameSelectionModal = document.getElementById('gameSelectionModal');
    const gameOptionElements = document.querySelectorAll('.game-option');
    const cancelGameSelectionBtn = document.getElementById('cancelGameSelectionBtn');

    const snakeGameModal = document.getElementById('snakeGameModal');
    const snakeGameCanvas = document.getElementById('snakeGameCanvas');
    const snakeGameScoreElement = document.getElementById('snakeGameScore');
    const snakeGameOverElement = document.getElementById('snakeGameOver');
    const finalScoreElement = document.getElementById('finalScore');
    const closeSnakeGameBtn = document.getElementById('closeSnakeGameBtn');

    const numberGuessGameModal = document.getElementById('numberGuessGameModal');
    const numberGuessInput = document.getElementById('numberGuessInput');
    const submitNumberGuessBtn = document.getElementById('submitNumberGuessBtn');
    const closeNumberGuessGameBtn = document.getElementById('closeNumberGuessGameBtn');
    const numberGuessResultElement = document.getElementById('numberGuessResult');

    let snakeGameContext = snakeGameCanvas.getContext('2d');
    let snake, snakeDirection, food, snakeGameInterval;
    let snakeGameScore = 0;
    let touchStartX = 0;
    let touchStartY = 0;
    let randomNumber; // Für das Zahlenratespiel

    // Funktionen
    function renderLists() {
        listsElement.innerHTML = '';
        lists.forEach((list, index) => {
            const li = document.createElement('li');
            li.textContent = list.name;
            li.addEventListener('click', () => {
                currentListIndex = index;
                openList();
            });
            listsElement.appendChild(li);
        });
    }

    function updateCoinDisplay() {
        coinCountElement.textContent = coins;
    }

    function openList() {
        vocabSection.classList.remove('hidden');
        listNameElement.textContent = 'Liste: ' + lists[currentListIndex].name;
        renderVocabularies();
    }

    function renderVocabularies() {
        vocabulariesElement.innerHTML = '';
        const vocabularies = lists[currentListIndex].vocabularies;
        vocabularies.forEach((vocab, index) => {
            const li = document.createElement('li');
            li.innerHTML = `
                ${vocab.word} - ${vocab.translation}
                <span class="icon" onclick="deleteVocab(${index})">&#128465;</span>
            `;
            vocabulariesElement.appendChild(li);
        });
    }

    function addList() {
        listNameInput.value = '';
        listModal.style.display = 'block';
        listNameInput.focus();
    }

    function saveList() {
        const listName = listNameInput.value.trim();
        if (listName) {
            lists.push({ name: listName, vocabularies: [] });
            saveLists();
            renderLists();
            listModal.style.display = 'none';
        } else {
            alert('Bitte geben Sie einen Listennamen ein.');
        }
    }

    function cancelList() {
        listModal.style.display = 'none';
    }

    function addVocabulary() {
        wordInput.value = '';
        translationInput.value = '';
        vocabModal.style.display = 'block';
        wordInput.focus();
    }

    function saveVocabulary() {
        const word = wordInput.value.trim();
        const translation = translationInput.value.trim();
        if (word && translation) {
            lists[currentListIndex].vocabularies.push({ word, translation });
            saveLists();
            renderVocabularies();
            vocabModal.style.display = 'none';
        } else {
            alert('Bitte geben Sie sowohl die Vokabel als auch die Übersetzung ein.');
        }
    }

    function cancelVocabulary() {
        vocabModal.style.display = 'none';
    }

    function deleteVocab(index) {
        if (confirm('Diese Vokabel wirklich löschen?')) {
            lists[currentListIndex].vocabularies.splice(index, 1);
            saveLists();
            renderVocabularies();
        }
    }

    function startQuiz() {
        if (lists[currentListIndex].vocabularies.length === 0) {
            alert('Diese Liste enthält keine Vokabeln.');
            return;
        }
        // Standardmäßig die erste Option auswählen
        quizOptionElements.forEach(option => option.classList.remove('selected'));
        quizOptionElements[0].classList.add('selected');
        quizDirection = quizOptionElements[0].getAttribute('data-value');
        quizSettingsModal.style.display = 'block';
    }

    function startQuizNow() {
        currentQuiz = lists[currentListIndex].vocabularies.map(vocab => ({ ...vocab, attempts: 0 }));
        shuffleArray(currentQuiz);
        quizQueue = [...currentQuiz];
        correctAnswers = 0;
        wrongAnswers = 0;
        progressFill.style.width = '0%';
        vocabSection.classList.add('hidden');
        quizSettingsModal.style.display = 'none';
        nextQuestion();
    }

    // Funktion zum Mischen des Arrays
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    let currentQuestion;

    function nextQuestion() {
        if (quizQueue.length > 0) {
            const totalQuestions = currentQuiz.length;
            const answeredQuestions = totalQuestions - quizQueue.length;
            const progressPercent = (answeredQuestions / totalQuestions) * 100;
            progressFill.style.width = progressPercent + '%';

            currentQuestion = quizQueue.shift();

            if (quizDirection === 'toGerman') {
                quizWordElement.textContent = currentQuestion.word;
            } else {
                quizWordElement.textContent = currentQuestion.translation;
            }

            quizInput.value = '';
            quizResultElement.textContent = '';
            quizResultElement.style.color = '';
            quizModal.style.display = 'block';
            quizInput.focus();
        } else {
            endQuiz();
        }
    }

    // Funktion zur Normalisierung der Antworten
    function normalizeAnswer(answer) {
        return answer.toLowerCase().trim().replace(/^to\s+/, '').replace(/\s+/g, ' ');
    }

    function submitAnswer() {
        const userAnswer = normalizeAnswer(quizInput.value);
        let correctAnswer;

        if (quizDirection === 'toGerman') {
            correctAnswer = normalizeAnswer(currentQuestion.translation);
        } else {
            correctAnswer = normalizeAnswer(currentQuestion.word);
        }

        if (userAnswer === correctAnswer) {
            quizResultElement.textContent = 'Richtig!';
            quizResultElement.style.color = 'green';
            correctAnswers++;

            // Kumulative richtige Antworten erhöhen
            totalCorrectAnswers++;
            saveTotalCorrectAnswers();
            checkForCoins();

        } else {
            quizResultElement.textContent = 'Falsch! Die richtige Antwort ist: ' + correctAnswer;
            quizResultElement.style.color = 'red';
            wrongAnswers++;

            // Erhöhe die Anzahl der Versuche
            currentQuestion.attempts++;
            if (currentQuestion.attempts < maxAttempts) {
                // Füge die Frage erneut in die Warteschlange ein
                quizQueue.push(currentQuestion);
                // Optional: Mischen, um die Frage an einer zufälligen Position einzufügen
                shuffleArray(quizQueue);
            }
        }

        submitQuizAnswerBtn.disabled = true;
        quizInput.disabled = true;
        setTimeout(() => {
            submitQuizAnswerBtn.disabled = false;
            quizInput.disabled = false;
            quizModal.style.display = 'none';
            nextQuestion();
        }, 2000);
    }

    function checkForCoins() {
        if (totalCorrectAnswers >= 20) {
            coins += 1;
            saveCoins();
            updateCoinDisplay();
            totalCorrectAnswers = 0;
            saveTotalCorrectAnswers();
            alert('Glückwunsch! Du hast eine Münze erhalten.');
        }
    }

    function endQuiz() {
        // Fortschrittsbalken auf 100% setzen
        progressFill.style.width = '100%';

        // Statistiken anzeigen
        totalQuestionsElement.textContent = correctAnswers + wrongAnswers;
        correctAnswersElement.textContent = correctAnswers;
        wrongAnswersElement.textContent = wrongAnswers;

        // Pie Chart erstellen
        setTimeout(() => {
            quizEndModal.style.display = 'block';
            createChart();
        }, 500);

        vocabSection.classList.remove('hidden');
    }

    function createChart() {
        const ctx = document.getElementById('quizChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Richtig', 'Falsch'],
                datasets: [{
                    data: [correctAnswers, wrongAnswers],
                    backgroundColor: ['#28a745', '#dc3545']
                }]
            },
            options: {
                responsive: false,
                legend: {
                    position: 'bottom'
                }
            }
        });
    }

    function closeQuizEndModal() {
        quizEndModal.style.display = 'none';
    }

    function openGameSelection() {
        if (coins < 1) {
            alert('Du hast nicht genügend Münzen, um ein Spiel zu spielen.');
            return;
        }
        gameSelectionModal.style.display = 'block';
    }

    function selectGame(game) {
        gameSelectionModal.style.display = 'none';
        coins -= 1;
        saveCoins();
        updateCoinDisplay();

        if (game === 'snake') {
            startSnakeGame();
        } else if (game === 'numberGuess') {
            startNumberGuessGame();
        }
    }

    function startSnakeGame() {
        snakeGameModal.style.display = 'block';
        snakeGameScore = 0;
        snakeGameScoreElement.textContent = 'Punkte: 0';
        snakeGameOverElement.classList.add('hidden');

        // Initialisierung
        snake = [{ x: 10, y: 10 }];
        snakeDirection = 'RIGHT';
        placeFood();

        // Event Listener für Tastatursteuerung
        document.addEventListener('keydown', changeSnakeDirection);

        // Event Listener für Touch-Steuerung
        snakeGameCanvas.addEventListener('touchstart', touchStart, false);
        snakeGameCanvas.addEventListener('touchmove', touchMove, false);

        snakeGameInterval = setInterval(moveSnake, 100);
    }

    function touchStart(e) {
        const touch = e.touches[0];
        touchStartX = touch.clientX;
        touchStartY = touch.clientY;
    }

    function touchMove(e) {
        if (!touchStartX || !touchStartY) {
            return;
        }

        const touch = e.touches[0];
        const touchEndX = touch.clientX;
        const touchEndY = touch.clientY;

        const deltaX = touchEndX - touchStartX;
        const deltaY = touchEndY - touchStartY;

        if (Math.abs(deltaX) > Math.abs(deltaY)) {
            if (deltaX > 0 && snakeDirection !== 'LEFT') {
                snakeDirection = 'RIGHT';
            } else if (deltaX < 0 && snakeDirection !== 'RIGHT') {
                snakeDirection = 'LEFT';
            }
        } else {
            if (deltaY > 0 && snakeDirection !== 'UP') {
                snakeDirection = 'DOWN';
            } else if (deltaY < 0 && snakeDirection !== 'DOWN') {
                snakeDirection = 'UP';
            }
        }

        touchStartX = null;
        touchStartY = null;
    }

    function changeSnakeDirection(e) {
        if (e.key === 'ArrowUp' && snakeDirection !== 'DOWN') {
            snakeDirection = 'UP';
        } else if (e.key === 'ArrowDown' && snakeDirection !== 'UP') {
            snakeDirection = 'DOWN';
        } else if (e.key === 'ArrowLeft' && snakeDirection !== 'RIGHT') {
            snakeDirection = 'LEFT';
        } else if (e.key === 'ArrowRight' && snakeDirection !== 'LEFT') {
            snakeDirection = 'RIGHT';
        }
    }

    function moveSnake() {
        let head = { ...snake[0] };
        if (snakeDirection === 'RIGHT') head.x += 1;
        if (snakeDirection === 'LEFT') head.x -= 1;
        if (snakeDirection === 'UP') head.y -= 1;
        if (snakeDirection === 'DOWN') head.y += 1;

        // Kollision mit Wand oder sich selbst
        if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || snake.some(segment => segment.x === head.x && segment.y === head.y)) {
            gameOver();
            return;
        }

        snake.unshift(head);

        // Kollision mit Essen
        if (head.x === food.x && head.y === food.y) {
            snakeGameScore += 10;
            snakeGameScoreElement.textContent = 'Punkte: ' + snakeGameScore;
            placeFood();
        } else {
            snake.pop();
        }

        drawSnakeGame();
    }

    function placeFood() {
        food = {
            x: Math.floor(Math.random() * 20),
            y: Math.floor(Math.random() * 20)
        };
        // Sicherstellen, dass das Essen nicht auf der Schlange erscheint
        if (snake.some(segment => segment.x === food.x && segment.y === food.y)) {
            placeFood();
        }
    }

    function drawSnakeGame() {
        snakeGameContext.fillStyle = '#000';
        snakeGameContext.fillRect(0, 0, snakeGameCanvas.width, snakeGameCanvas.height);

        // Zeichne Essen
        snakeGameContext.fillStyle = 'red';
        snakeGameContext.fillRect(food.x * 20, food.y * 20, 20, 20);

        // Zeichne Schlange
        snakeGameContext.fillStyle = 'lime';
        snake.forEach(segment => {
            snakeGameContext.fillRect(segment.x * 20, segment.y * 20, 20, 20);
        });
    }

    function gameOver() {
        clearInterval(snakeGameInterval);
        document.removeEventListener('keydown', changeSnakeDirection);
        snakeGameCanvas.removeEventListener('touchstart', touchStart);
        snakeGameCanvas.removeEventListener('touchmove', touchMove);
        snakeGameOverElement.classList.remove('hidden');
        finalScoreElement.textContent = snakeGameScore;
    }

    function closeSnakeGame() {
        snakeGameModal.style.display = 'none';
        clearInterval(snakeGameInterval);
        document.removeEventListener('keydown', changeSnakeDirection);
        snakeGameCanvas.removeEventListener('touchstart', touchStart);
        snakeGameCanvas.removeEventListener('touchmove', touchMove);
    }

    function startNumberGuessGame() {
        numberGuessGameModal.style.display = 'block';
        numberGuessInput.value = '';
        numberGuessResultElement.textContent = '';
        randomNumber = Math.floor(Math.random() * 10) + 1;
    }

    function submitNumberGuess() {
        const userGuess = parseInt(numberGuessInput.value);
        if (userGuess === randomNumber) {
            numberGuessResultElement.textContent = 'Glückwunsch! Du hast die richtige Zahl erraten.';
            numberGuessResultElement.style.color = 'green';
        } else {
            numberGuessResultElement.textContent = 'Falsch! Die richtige Zahl war ' + randomNumber + '.';
            numberGuessResultElement.style.color = 'red';
        }
        submitNumberGuessBtn.disabled = true;
        numberGuessInput.disabled = true;
    }

    function closeNumberGuessGame() {
        numberGuessGameModal.style.display = 'none';
        submitNumberGuessBtn.disabled = false;
        numberGuessInput.disabled = false;
    }

    function saveLists() {
        localStorage.setItem('vocabLists', JSON.stringify(lists));
    }

    function saveCoins() {
        localStorage.setItem('coins', coins);
    }

    function saveTotalCorrectAnswers() {
        localStorage.setItem('totalCorrectAnswers', totalCorrectAnswers);
    }

    // Event Listener
    addListBtn.addEventListener('click', addList);
    saveListBtn.addEventListener('click', saveList);
    cancelListBtn.addEventListener('click', cancelList);

    addVocabBtn.addEventListener('click', addVocabulary);
    saveVocabBtn.addEventListener('click', saveVocabulary);
    cancelVocabBtn.addEventListener('click', cancelVocabulary);

    startQuizBtn.addEventListener('click', startQuiz);
    startQuizNowBtn.addEventListener('click', startQuizNow);
    cancelQuizSettingsBtn.addEventListener('click', () => {
        quizSettingsModal.style.display = 'none';
    });

    submitQuizAnswerBtn.addEventListener('click', submitAnswer);

    closeQuizEndBtn.addEventListener('click', closeQuizEndModal);

    playGameBtn.addEventListener('click', openGameSelection);

    gameOptionElements.forEach(option => {
        option.addEventListener('click', () => {
            selectGame(option.getAttribute('data-game'));
        });
    });

    cancelGameSelectionBtn.addEventListener('click', () => {
        gameSelectionModal.style.display = 'none';
    });

    closeSnakeGameBtn.addEventListener('click', closeSnakeGame);

    submitNumberGuessBtn.addEventListener('click', submitNumberGuess);
    closeNumberGuessGameBtn.addEventListener('click', closeNumberGuessGame);

    // Auswahl der Abfragerichtung
    quizOptionElements.forEach(option => {
        option.addEventListener('click', () => {
            quizOptionElements.forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            quizDirection = option.getAttribute('data-value');
        });
    });

    // Hinzufügen von Enter-Taste für die Antwort im Quiz
    quizInput.addEventListener('keyup', function(event) {
        if (event.key === 'Enter') {
            submitAnswer();
        }
    });

    // Hinzufügen von Enter-Taste für das Zahlenratespiel
    numberGuessInput.addEventListener('keyup', function(event) {
        if (event.key === 'Enter') {
            submitNumberGuess();
        }
    });

    // Klick außerhalb des Modals zum Schließen
    window.addEventListener('click', function(event) {
        if (event.target === listModal) {
            listModal.style.display = 'none';
        }
        if (event.target === vocabModal) {
            vocabModal.style.display = 'none';
        }
        if (event.target === quizSettingsModal) {
            quizSettingsModal.style.display = 'none';
        }
        if (event.target === quizModal) {
            // quizModal.style.display = 'none'; // Quiz sollte nicht durch Klick außerhalb geschlossen werden
        }
        if (event.target === quizEndModal) {
            quizEndModal.style.display = 'none';
        }
        if (event.target === gameSelectionModal) {
            gameSelectionModal.style.display = 'none';
        }
        if (event.target === snakeGameModal) {
            closeSnakeGame();
        }
        if (event.target === numberGuessGameModal) {
            closeNumberGuessGame();
        }
    });

    // Initiales Rendern
    renderLists();
    updateCoinDisplay();
</script>

</body>
</html>