<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>V-Vokabeltrainer</title>
    <!-- Einbindung von Font Awesome über CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="v.png" type="image/png">
    <style>
        /* Grundlegende Stile */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
	href {
	    color: #333;
	    text-decoration: underline;
	    size: 15;
	}
	href:hover {
	    color: #007bff;
	    text-decoration: underline;
	}
        .container {
            max-width: 800px;
            margin: auto;
        }
        .list-header, .coin-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .list-header h2 {
            margin: 0;
        }
        /* Button-Stile */
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        /* Listenstile */
        #lists, #vocabularies {
            list-style-type: none;
            padding: 0;
            margin-top: 20px;
        }
        #lists li, #vocabularies li {
            background-color: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #lists li:hover, #vocabularies li:hover {
            background-color: #e9ecef;
        }
        .icon {
            cursor: pointer;
            font-size: 24px;
            color: #dc3545;
            transition: color 0.3s;
        }
        .icon:hover {
            color: #c82333;
        }
        .hidden {
            display: none;
        }
        /* Eingabefelder */
        input[type="text"], input[type="number"] {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
            font-size: 16px;
        }
        /* Modale Fenster */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 95%;
            max-width: 500px;
            border-radius: 10px;
            animation: modalFadeIn 0.5s;
            position: relative;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-header {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        .modal-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .modal-buttons {
            text-align: right;
        }
        .modal-buttons button {
            margin-left: 10px;
        }
        /* Quiz-spezifische Stile */
        #quizModal .modal-content {
            margin-top: 5%;
        }
        #quizResult {
            margin-top: 10px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }
        .progress-bar {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .progress-fill {
            height: 10px;
            background-color: #007bff;
            width: 0%;
            transition: width 0.3s;
        }
        .quiz-question {
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        .quiz-input {
            font-size: 18px;
            padding: 10px;
            margin-bottom: 10px;
        }
        .quiz-option {
            display: inline-block;
            width: 45%;
            margin: 5px 2.5%;
            padding: 15px;
            background-color: #e9ecef;
            color: #333;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        .quiz-option:hover {
            background-color: #ced4da;
        }
        .quiz-option.selected {
            background-color: #007bff;
            color: white;
        }
        /* Statistiken-Modal */
        #quizEndModal .modal-content {
            margin-top: 10%;
            text-align: center;
        }
        .stats {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .stats .number {
            font-weight: bold;
            font-size: 24px;
            color: #007bff;
        }
        /* Pie Chart Canvas */
        #quizChart {
            margin: 20px auto;
            display: block;
        }
        /* Share Buttons */
        .share-buttons {
            margin-top: 20px;
            text-align: center;
        }
        .share-buttons button {
            margin: 5px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-size: 32px;
            transition: color 0.3s;
	    color: #007bff;
        }
        .share-buttons button:hover {
            color: #0056b3;
        }
        /* Streak Anzeige */
        .streak {
            font-size: 24px;
            color: #ff6f00;
            display: flex;
            align-items: center;
        }
        .streak i {
            margin-right: 5px;
        }
        /* Coins Anzeige */
        .coins {
            font-size: 24px;
            color: #ffd700;
            display: flex;
            align-items: center;
        }
        .coins i {
            margin-right: 5px;
        }
        .coin-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .coin-section .left-section {
            display: flex;
            align-items: center;
        }
        .coin-section .left-section > div {
            margin-right: 20px;
        }

        .streak-stat {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .streak-stat .number {
            font-weight: bold;
            font-size: 24px;
            color: #ff6f00;
        }
	#playGameBtn {
            background-color: transparent;
	    border: none;
	    cursor: pointer;
	    font-size: 26px;
	    color: #007bff;
	    transition: color 0.3s;
	    display: flex;
	}
	#playGameBtn:hover {
	    color: #0056b3;
	}
    </style>
    <!-- Einbindung von Chart.js über CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">
    <h1>Vokabeltrainer</h1>

    <!-- Münzenanzeige und Streak -->
    <div class="coin-section">
        <div class="left-section">
            <div class="coins">
                <i class="fas fa-coins"></i>
                <span id="coinCount">0</span>
            </div>
            <div class="streak">
                <i class="fas fa-fire"></i>
                <span id="streakCount">0</span>
            </div>
		<button id="playGameBtn" title="Spiele spielen"><i class="fas fa-gamepad"></i></button>
        </div>
		<href href="about.html">About</href>
    </div>
<br>
    <div class="list-header">
        <h2>Vokabellisten</h2>
        <button id="addListBtn">+ Neue Liste</button>
    </div>

    <ul id="lists">
        <!-- Vokabellisten werden hier angezeigt -->
    </ul>

    <div id="vocabSection" class="hidden">
        <div class="list-header">
            <h2 id="listName">Liste: </h2>
            <button id="addVocabBtn">+ Neue Vokabel</button>
        </div>

        <ul id="vocabularies">
            <!-- Vokabeln werden hier angezeigt -->
        </ul>

        <button id="startQuizBtn">Quiz starten</button>
    </div>
</div>

<!-- Modale Fenster -->
<!-- Liste erstellen Modal -->
<div id="listModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Neue Liste erstellen</div>
        <input type="text" id="listNameInput" class="modal-input" placeholder="Name der neuen Liste">
        <div class="modal-buttons">
            <button id="cancelListBtn">Abbrechen</button>
            <button id="saveListBtn">Speichern</button>
        </div>
    </div>
</div>

<!-- Vokabel hinzufügen Modal -->
<div id="vocabModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Neue Vokabel hinzufügen</div>
        <input type="text" id="wordInput" class="modal-input" placeholder="Fremdwort (z.B. Englisch)">
        <input type="text" id="translationInput" class="modal-input" placeholder="Übersetzung (z.B. Deutsch)">
        <div class="modal-buttons">
            <button id="cancelVocabBtn">Abbrechen</button>
            <button id="saveVocabBtn">Speichern</button>
        </div>
    </div>
</div>

<!-- Quiz-Einstellungen Modal -->
<div id="quizSettingsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Quiz-Einstellungen</div>
        <div class="quiz-options">
            <div class="quiz-option selected" data-value="toGerman">Fremdsprache ➔ Deutsch</div>
            <div class="quiz-option" data-value="fromGerman">Deutsch ➔ Fremdsprache</div>
        </div>
        <div class="modal-buttons">
            <button id="cancelQuizSettingsBtn">Abbrechen</button>
            <button id="startQuizNowBtn">Quiz starten</button>
        </div>
    </div>
</div>

<!-- Quiz Modal -->
<div id="quizModal" class="modal">
    <div class="modal-content">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="quiz-question">
            Übersetze: <strong id="quizWord"></strong>
        </div>
        <input type="text" id="quizInput" class="quiz-input" placeholder="Antwort eingeben...">
        <div id="quizResult"></div>
        <div class="modal-buttons">
            <button id="submitQuizAnswerBtn">Antwort abschicken</button>
        </div>
    </div>
</div>

<!-- Quiz beendet Modal -->
<div id="quizEndModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Quiz beendet!</div>
        <div class="stats">
            Gesamtzahl der Fragen: <span class="number" id="totalQuestions"></span>
        </div>
        <div class="stats">
            Richtige Antworten: <span class="number" id="correctAnswers"></span>
        </div>
        <div class="stats">
            Falsche Antworten: <span class="number" id="wrongAnswers"></span>
        </div>
        <!-- Anzeige des Streaks -->
        <div class="streak-stat">
            Aktueller Streak: <span class="number" id="streakDisplay"></span> Tage 🔥
        </div>
        <!-- Canvas für das Kreisdiagramm -->
        <canvas id="quizChart" width="200" height="200"></canvas>
        <!-- Share Buttons für Quiz-Ergebnisse -->
        <div class="share-buttons">
            <button id="shareWhatsAppBtn"><i class="fab fa-whatsapp"></i></button>
            <button id="shareFacebookBtn"><i class="fab fa-facebook"></i></button>
            <button id="shareTwitterBtn"><i class="fab fa-twitter"></i></button>
            <button id="shareEmailBtn"><i class="fas fa-envelope"></i></button>
        </div>
        <div class="modal-buttons">
            <button id="closeQuizEndBtn">Schließen</button>
        </div>
    </div>
</div>

<!-- iFrame Modal -->
<div id="iframeModal" class="modal">
    <div class="modal-content">
        <iframe id="gameIframe" src=""></iframe>
        <button id="closeIframeBtn">Schließen</button>
    </div>
</div>

<!-- Spielzeit-Auswahl Modal -->
<div id="gameTimeModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">Spielzeit auswählen</div>
        <input type="number" id="gameTimeInput" class="modal-input" placeholder="Anzahl der Münzen (1 Münze = 1 Minute)" min="1">
        <div class="modal-buttons">
            <button id="cancelGameTimeBtn">Abbrechen</button>
            <button id="startGameBtn">Spiel starten</button>
        </div>
    </div>
</div>

<script>
    // Variablen
    let lists = JSON.parse(localStorage.getItem('vocabLists')) || [];
    let coins = parseInt(localStorage.getItem('coins')) || 0;
    let totalCorrectAnswers = parseInt(localStorage.getItem('totalCorrectAnswers')) || 0;
    let currentListIndex = null;
    let currentQuiz = null;
    let quizQueue = [];
    let correctAnswers = 0;
    let wrongAnswers = 0;
    let quizDirection = 'toGerman'; // 'toGerman' oder 'fromGerman'
    let maxAttempts = 2; // Maximale Anzahl der Versuche pro Vokabel
    let streakCount = parseInt(localStorage.getItem('streakCount')) || 0;
    let lastQuizDate = localStorage.getItem('lastQuizDate') || null;

    const listsElement = document.getElementById('lists');
    const vocabSection = document.getElementById('vocabSection');
    const vocabulariesElement = document.getElementById('vocabularies');
    const listNameElement = document.getElementById('listName');
    const addListBtn = document.getElementById('addListBtn');
    const addVocabBtn = document.getElementById('addVocabBtn');
    const startQuizBtn = document.getElementById('startQuizBtn');
    const coinCountElement = document.getElementById('coinCount');
    const playGameBtn = document.getElementById('playGameBtn');
    const streakCountElement = document.getElementById('streakCount');

    // Modale Elemente
    const listModal = document.getElementById('listModal');
    const listNameInput = document.getElementById('listNameInput');
    const saveListBtn = document.getElementById('saveListBtn');
    const cancelListBtn = document.getElementById('cancelListBtn');

    const vocabModal = document.getElementById('vocabModal');
    const wordInput = document.getElementById('wordInput');
    const translationInput = document.getElementById('translationInput');
    const saveVocabBtn = document.getElementById('saveVocabBtn');
    const cancelVocabBtn = document.getElementById('cancelVocabBtn');

    const quizSettingsModal = document.getElementById('quizSettingsModal');
    const cancelQuizSettingsBtn = document.getElementById('cancelQuizSettingsBtn');
    const startQuizNowBtn = document.getElementById('startQuizNowBtn');
    const quizOptionElements = document.querySelectorAll('.quiz-option');

    const quizModal = document.getElementById('quizModal');
    const quizWordElement = document.getElementById('quizWord');
    const quizInput = document.getElementById('quizInput');
    const submitQuizAnswerBtn = document.getElementById('submitQuizAnswerBtn');
    const quizResultElement = document.getElementById('quizResult');
    const progressFill = document.getElementById('progressFill');

    const quizEndModal = document.getElementById('quizEndModal');
    const totalQuestionsElement = document.getElementById('totalQuestions');
    const correctAnswersElement = document.getElementById('correctAnswers');
    const wrongAnswersElement = document.getElementById('wrongAnswers');
    const closeQuizEndBtn = document.getElementById('closeQuizEndBtn');
    const streakDisplayElement = document.getElementById('streakDisplay');

    const iframeModal = document.getElementById('iframeModal');
    const gameIframe = document.getElementById('gameIframe');
    const closeIframeBtn = document.getElementById('closeIframeBtn');

    const gameTimeModal = document.getElementById('gameTimeModal');
    const gameTimeInput = document.getElementById('gameTimeInput');
    const startGameBtn = document.getElementById('startGameBtn');
    const cancelGameTimeBtn = document.getElementById('cancelGameTimeBtn');

    // Share Buttons
    const shareWhatsAppBtn = document.getElementById('shareWhatsAppBtn');
    const shareFacebookBtn = document.getElementById('shareFacebookBtn');
    const shareTwitterBtn = document.getElementById('shareTwitterBtn');
    const shareEmailBtn = document.getElementById('shareEmailBtn');

    
    let iframeTimeout;

    // Funktionen
    function renderLists() {
        listsElement.innerHTML = '';
        lists.forEach((list, index) => {
            const li = document.createElement('li');
            li.textContent = list.name;
            li.addEventListener('click', () => {
                currentListIndex = index;
                openList();
            });
            listsElement.appendChild(li);
        });
    }

    function updateCoinDisplay() {
        coinCountElement.textContent = coins;
    }

    function updateStreakDisplay() {
        streakCountElement.textContent = streakCount;
    }

    function openList() {
        vocabSection.classList.remove('hidden');
        listNameElement.textContent = 'Liste: ' + lists[currentListIndex].name;
        renderVocabularies();
    }

    function renderVocabularies() {
        vocabulariesElement.innerHTML = '';
        const vocabularies = lists[currentListIndex].vocabularies;
        vocabularies.forEach((vocab, index) => {
            const li = document.createElement('li');
            li.innerHTML = `
                <span>${vocab.word} - ${vocab.translation}</span>
                <span class="icon" title="Vokabel löschen"><i class="fas fa-trash"></i></span>
            `;
            // Event Listener für das Löschen der Vokabel
            li.querySelector('.icon').addEventListener('click', (e) => {
                e.stopPropagation();
                deleteVocab(index);
            });
            listsElement.appendChild(li);
            vocabulariesElement.appendChild(li);
        });
    }

    function addList() {
        listNameInput.value = '';
        listModal.style.display = 'block';
        listNameInput.focus();
    }

    function saveList() {
        const listName = listNameInput.value.trim();
        if (listName) {
            lists.push({ name: listName, vocabularies: [] });
            saveLists();
            renderLists();
            listModal.style.display = 'none';
        } else {
            alert('Bitte geben Sie einen Listennamen ein.');
        }
    }

    function cancelList() {
        listModal.style.display = 'none';
    }

    function addVocabulary() {
        wordInput.value = '';
        translationInput.value = '';
        vocabModal.style.display = 'block';
        wordInput.focus();
    }

    function saveVocabulary() {
        const word = wordInput.value.trim();
        const translation = translationInput.value.trim();
        if (word && translation) {
            lists[currentListIndex].vocabularies.push({ word, translation });
            saveLists();
            renderVocabularies();
            vocabModal.style.display = 'none';
        } else {
            alert('Bitte geben Sie sowohl die Vokabel als auch die Übersetzung ein.');
        }
    }

    function cancelVocabulary() {
        vocabModal.style.display = 'none';
    }

    function deleteVocab(index) {
        if (confirm('Diese Vokabel wirklich löschen?')) {
            lists[currentListIndex].vocabularies.splice(index, 1);
            saveLists();
            renderVocabularies();
        }
    }

    function startQuiz() {
        if (lists[currentListIndex].vocabularies.length === 0) {
            alert('Diese Liste enthält keine Vokabeln.');
            return;
        }
        // Standardmäßig die erste Option auswählen
        quizOptionElements.forEach(option => option.classList.remove('selected'));
        quizOptionElements[0].classList.add('selected');
        quizDirection = quizOptionElements[0].getAttribute('data-value');
        quizSettingsModal.style.display = 'block';
    }

    function startQuizNow() {
        currentQuiz = lists[currentListIndex].vocabularies.map(vocab => ({ ...vocab, attempts: 0 }));
        shuffleArray(currentQuiz);
        quizQueue = [...currentQuiz];
        correctAnswers = 0;
        wrongAnswers = 0;
        progressFill.style.width = '0%';
        vocabSection.classList.add('hidden');
        quizSettingsModal.style.display = 'none';
        nextQuestion();
    }

    // Funktion zum Mischen des Arrays
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    let currentQuestion;

    function nextQuestion() {
        if (quizQueue.length > 0) {
            const totalQuestions = currentQuiz.length;
            const answeredQuestions = totalQuestions - quizQueue.length;
            const progressPercent = (answeredQuestions / totalQuestions) * 100;
            progressFill.style.width = progressPercent + '%';

            currentQuestion = quizQueue.shift();

            if (quizDirection === 'toGerman') {
                quizWordElement.textContent = currentQuestion.word;
            } else {
                quizWordElement.textContent = currentQuestion.translation;
            }

            quizInput.value = '';
            quizResultElement.textContent = '';
            quizResultElement.style.color = '';
            quizModal.style.display = 'block';
            quizInput.focus();
        } else {
            endQuiz();
        }
    }

    // Funktion zur Normalisierung der Antworten
    function normalizeAnswer(answer) {
        return answer.toLowerCase().trim().replace(/^to\s+/, '').replace(/\s+/g, ' ');
    }

    function submitAnswer() {
        const userAnswer = normalizeAnswer(quizInput.value);
        let correctAnswer;

        if (quizDirection === 'toGerman') {
            correctAnswer = normalizeAnswer(currentQuestion.translation);
        } else {
            correctAnswer = normalizeAnswer(currentQuestion.word);
        }

        if (userAnswer === correctAnswer) {
            quizResultElement.textContent = 'Richtig!';
            quizResultElement.style.color = 'green';
            correctAnswers++;

            // Kumulative richtige Antworten erhöhen
            totalCorrectAnswers++;
            saveTotalCorrectAnswers();
            checkForCoins();
        } else {
            quizResultElement.textContent = 'Falsch! Die richtige Antwort ist: ' + correctAnswer;
            quizResultElement.style.color = 'red';
            wrongAnswers++;

            // Erhöhe die Anzahl der Versuche
            currentQuestion.attempts++;
            if (currentQuestion.attempts < maxAttempts) {
                // Füge die Frage erneut in die Warteschlange ein
                quizQueue.push(currentQuestion);
                // Optional: Mischen, um die Frage an einer zufälligen Position einzufügen
                shuffleArray(quizQueue);
            }
        }

        submitQuizAnswerBtn.disabled = true;
        quizInput.disabled = true;
        setTimeout(() => {
            submitQuizAnswerBtn.disabled = false;
            quizInput.disabled = false;
            quizModal.style.display = 'none';
            nextQuestion();
        }, 2000);
    }

    function checkForCoins() {
        if (totalCorrectAnswers >= 20) {
            coins += 1;
            saveCoins();
            updateCoinDisplay();
            totalCorrectAnswers = 0;
            saveTotalCorrectAnswers();
            alert('Glückwunsch! Du hast eine Münze erhalten.');
        }
    }

    function endQuiz() {
        // Fortschrittsbalken auf 100% setzen
        progressFill.style.width = '100%';

        // Streak aktualisieren
        updateStreak();

        // Statistiken anzeigen
        totalQuestionsElement.textContent = correctAnswers + wrongAnswers;
        correctAnswersElement.textContent = correctAnswers;
        wrongAnswersElement.textContent = wrongAnswers;

        // Streak im Modal anzeigen
        streakDisplayElement.textContent = streakCount;

        // Pie Chart erstellen
        setTimeout(() => {
            quizEndModal.style.display = 'block';
            createChart();
        }, 500);

        vocabSection.classList.remove('hidden');
    }

    function createChart() {
        const ctx = document.getElementById('quizChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Richtig', 'Falsch'],
                datasets: [{
                    data: [correctAnswers, wrongAnswers],
                    backgroundColor: ['#28a745', '#dc3545']
                }]
            },
            options: {
                responsive: false,
                legend: {
                    position: 'bottom'
                }
            }
        });
    }

    function closeQuizEndModal() {
        quizEndModal.style.display = 'none';
    }

    function openGameTimeModal() {
        if (coins < 1) {
            alert('Du hast nicht genügend Münzen, um ein Spiel zu spielen.');
            return;
        }
        gameTimeInput.value = '';
        gameTimeInput.max = coins;
        gameTimeModal.style.display = 'block';
    }

    function startGame() {
        const coinsToSpend = parseInt(gameTimeInput.value);
        if (isNaN(coinsToSpend) || coinsToSpend < 1) {
            alert('Bitte gib eine gültige Anzahl an Münzen ein.');
            return;
        }
        if (coinsToSpend > coins) {
            alert('Du hast nicht genügend Münzen.');
            return;
        }
        coins -= coinsToSpend;
        saveCoins();
        updateCoinDisplay();

        // iFrame anzeigen
        iframeModal.style.display = 'block';
        gameIframe.src = 'https://snake-game.io/'; // Ersetzen Sie diese URL durch die gewünschte Spiele-Website

        // Timer starten
        iframeTimeout = setTimeout(() => {
            closeIframe();
            alert('Die Spielzeit ist abgelaufen.');
        }, coinsToSpend * 60 * 1000); // Minuten in Millisekunden

        gameTimeModal.style.display = 'none';
    }

    function cancelGameTime() {
        gameTimeModal.style.display = 'none';
    }

    function closeIframe() {
        iframeModal.style.display = 'none';
        gameIframe.src = '';
        clearTimeout(iframeTimeout);
    }

    function saveLists() {
        localStorage.setItem('vocabLists', JSON.stringify(lists));
    }

    function saveCoins() {
        localStorage.setItem('coins', coins);
    }

    function saveTotalCorrectAnswers() {
        localStorage.setItem('totalCorrectAnswers', totalCorrectAnswers);
    }

    function saveStreakData() {
        localStorage.setItem('streakCount', streakCount);
        localStorage.setItem('lastQuizDate', lastQuizDate);
    }

    function updateStreak() {
        const today = new Date();
        const lastDate = lastQuizDate ? new Date(lastQuizDate) : null;

        if (lastDate) {
            const diffTime = today.getTime() - lastDate.getTime();
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays === 1) {
                // Streak fortsetzen
                streakCount++;
            } else if (diffDays > 1) {
                // Streak zurücksetzen
                streakCount = 1;
            }
            // Wenn diffDays === 0, Streak bleibt unverändert (mehrere Quizzes am gleichen Tag)
        } else {
            // Erster Tag
            streakCount = 1;
        }

        lastQuizDate = today.toDateString();
        saveStreakData();
        updateStreakDisplay();
    }

    // Funktionen zum Teilen der Ergebnisse
    function createShareMessage() {
        return `Ich habe gerade ein Quiz abgeschlossen!\n\n` +
        `Gesamtzahl der Fragen: ${correctAnswers + wrongAnswers}\n` +
        `Richtige Antworten: ${correctAnswers}\n` +
        `Falsche Antworten: ${wrongAnswers}\n` +
        `Streak: ${streakCount} Tage 🔥`;
    }

    function shareOnWhatsApp() {
        const message = createShareMessage();
        const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`;
        window.open(url, '_blank');
    }

    function shareOnFacebook() {
        const message = createShareMessage();
        const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(location.href)}&quote=${encodeURIComponent(message)}`;
        window.open(url, '_blank');
    }

    function shareOnTwitter() {
        const message = createShareMessage();
        const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}&url=${encodeURIComponent(location.href)}`;
        window.open(url, '_blank');
    }

    function shareViaEmail() {
        const subject = 'Meine Quiz-Ergebnisse';
        const body = createShareMessage();
        const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        window.location.href = mailtoLink;
    }

    // Event Listener
    addListBtn.addEventListener('click', addList);
    saveListBtn.addEventListener('click', saveList);
    cancelListBtn.addEventListener('click', cancelList);

    addVocabBtn.addEventListener('click', addVocabulary);
    saveVocabBtn.addEventListener('click', saveVocabulary);
    cancelVocabBtn.addEventListener('click', cancelVocabulary);

    startQuizBtn.addEventListener('click', startQuiz);
    startQuizNowBtn.addEventListener('click', startQuizNow);
    cancelQuizSettingsBtn.addEventListener('click', () => {
        quizSettingsModal.style.display = 'none';
    });

    submitQuizAnswerBtn.addEventListener('click', submitAnswer);

    closeQuizEndBtn.addEventListener('click', closeQuizEndModal);

    playGameBtn.addEventListener('click', openGameTimeModal);
    startGameBtn.addEventListener('click', startGame);
    cancelGameTimeBtn.addEventListener('click', cancelGameTime);

    closeIframeBtn.addEventListener('click', closeIframe);

    // Event Listener für Share Buttons der Quiz-Ergebnisse
    shareWhatsAppBtn.addEventListener('click', shareOnWhatsApp);
    shareFacebookBtn.addEventListener('click', shareOnFacebook);
    shareTwitterBtn.addEventListener('click', shareOnTwitter);
    shareEmailBtn.addEventListener('click', shareViaEmail);

    
    // Auswahl der Abfragerichtung
    quizOptionElements.forEach(option => {
        option.addEventListener('click', () => {
            quizOptionElements.forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            quizDirection = option.getAttribute('data-value');
        });
    });

    // Hinzufügen von Enter-Taste für die Antwort im Quiz
    quizInput.addEventListener('keyup', function(event) {
        if (event.key === 'Enter') {
            submitAnswer();
        }
    });

    // Klick außerhalb des Modals zum Schließen
    window.addEventListener('click', function(event) {
        if (event.target === listModal) {
            listModal.style.display = 'none';
        }
        if (event.target === vocabModal) {
            vocabModal.style.display = 'none';
        }
        if (event.target === quizSettingsModal) {
            quizSettingsModal.style.display = 'none';
        }
        if (event.target === quizModal) {
            // quizModal.style.display = 'none'; // Quiz sollte nicht durch Klick außerhalb geschlossen werden
        }
        if (event.target === quizEndModal) {
            quizEndModal.style.display = 'none';
        }
        if (event.target === iframeModal) {
            closeIframe();
        }
        if (event.target === gameTimeModal) {
            gameTimeModal.style.display = 'none';
        }
    });

    // Initiales Rendern und Laden der Daten
    window.onload = function() {
        renderLists();
        updateCoinDisplay();
        updateStreakDisplay();

        // Prüfen, ob der letzte Quiz-Tag nicht heute ist, um den Streak ggf. zurückzusetzen
        const today = new Date().toDateString();
        if (lastQuizDate && lastQuizDate !== today) {
            const lastDate = new Date(lastQuizDate);
            const currentDate = new Date();
            const diffTime = currentDate.getTime() - lastDate.getTime();
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays > 1) {
                streakCount = 0;
                saveStreakData();
                updateStreakDisplay();
            }
        }
    };
</script>

</body>
</html>
